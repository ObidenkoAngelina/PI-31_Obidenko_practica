<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Community Simulation</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        #app {
            font-family: Arial, sans-serif;
            margin: 20px;
            position: relative;
        }
        .simulation-area {
            width: 600px;
            height: 400px;
            border: 2px solid #2c3e50;
            position: relative;
            background-color: #ecf0f1;
            margin-bottom: 20px;
        }
        .plant {
            position: absolute;
            border-radius: 50%;
            opacity: 0.8;
            transition: all 0.5s ease;
            cursor: pointer;
        }
        .plant::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: clamp(20px, 50%, calc(100% - 20px));
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: pre;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
            pointer-events: none;
            min-width: 120px;
            text-align: center;
        }
        .plant:hover::after {
            visibility: visible;
            opacity: 1;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background 0.2s;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .stats {
            margin-top: 20px;
            font-size: 16px;
        }
        h1 {
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Plant Community Simulation</h1>
        
        <div class="controls">
            <button @click="addPlant">Add Plant</button>
            <button @click="simulateDay">Simulate 1 Day</button>
            <button @click="startSimulation" :disabled="isSimulating">Start Simulation</button>
            <button @click="stopSimulation" :disabled="!isSimulating">Stop Simulation</button>
            <button @click="reset">Reset</button>
        </div>
        
        <div class="simulation-area" ref="simulationArea">
            <div 
                v-for="plant in plants" 
                :key="plant.id"  
                class="plant"
                :data-tooltip="getPlantTooltip(plant)"
                :style="{
                    left: plant.x + 'px',
                    top: plant.y + 'px',
                    width: plant.size + 'px',
                    height: plant.size + 'px',
                    backgroundColor: plant.color,
                    zIndex: plant.height
                }"
            ></div>
        </div>
        
        <div class="stats">
            <p>Day: {{ day }}</p>
            <p>Plants: {{ plants.length }}</p>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        
        createApp({
            setup() {
                const simulationArea = ref(null);
                const plants = ref([]);
                const day = ref(0);
                const isSimulating = ref(false);
                let simulationInterval = null;
                
                const plantTypes = [
                    { name: 'Tree', color: '#27ae60', growthRate: 1.2, aggression: 0.7, maxSize: 100, shadeTolerance: 0.3 },
                    { name: 'Bush', color: '#16a085', growthRate: 1.5, aggression: 0.5, maxSize: 60, shadeTolerance: 0.6 },
                    { name: 'Flower', color: '#e74c3c', growthRate: 2.0, aggression: 0.3, maxSize: 30, shadeTolerance: 0.8 },
                    { name: 'Grass', color: '#2ecc71', growthRate: 1.8, aggression: 0.4, maxSize: 20, shadeTolerance: 0.9 }
                ];
                
                const getPlantTooltip = (plant) => {
                    return `Type: ${plant.type}\nAge: ${plant.age} days\nHealth: ${plant.health.toFixed(2)}\nSize: ${plant.size.toFixed(1)}px`;
                };
                
                const addPlant = () => {
                    if (!simulationArea.value) return;
                    
                    const areaWidth = simulationArea.value.clientWidth;
                    const areaHeight = simulationArea.value.clientHeight;
                    const type = plantTypes[Math.floor(Math.random() * plantTypes.length)];
                    const size = 10 + Math.random() * 10;
                    
                    const x = Math.max(0, Math.min(areaWidth - size, Math.random() * (areaWidth - size)));
                    const y = Math.max(0, Math.min(areaHeight - size, Math.random() * (areaHeight - size)));
                    
                    plants.value.push({
                        id: Date.now() + Math.random(),
                        x: x,
                        y: y,
                        size: size,
                        color: type.color,
                        type: type.name,
                        growthRate: type.growthRate,
                        aggression: type.aggression,
                        maxSize: type.maxSize,
                        shadeTolerance: type.shadeTolerance,
                        height: Math.floor(Math.random() * 3) + 1,
                        age: 0,
                        health: 1.0
                    });
                };
                
                const calculateLight = (plant) => {
                    let light = 1.0;
                    
                    for (const otherPlant of plants.value) {
                        if (otherPlant.height > plant.height) {
                            const distance = Math.sqrt(
                                Math.pow(plant.x - otherPlant.x, 2) + 
                                Math.pow(plant.y - otherPlant.y, 2)
                            );
                        
                            if (distance < (plant.size + otherPlant.size) / 2) {
                                light -= 0.3 * (1 - plant.shadeTolerance);
                            }
                        }
                    }
                    
                    return Math.max(0.1, light);
                };
                
                const simulateDay = () => {
                    day.value++;
                    const areaWidth = simulationArea.value.clientWidth;
                    const areaHeight = simulationArea.value.clientHeight;
                    
                    for (let i = 0; i < plants.value.length; i++) {
                        const plant = plants.value[i];
                        plant.age++;
                        
                        const light = calculateLight(plant);
                        
                        plant.health = Math.min(1.0, plant.health + 0.05 * light * plant.aggression - 0.02);
                        
                        if (plant.health <= 0) {
                            plants.value.splice(i, 1);
                            i--;
                            continue;
                        }
                        
                        if (plant.health > 0.5 && plant.size < plant.maxSize) {
                            plant.size += plant.growthRate * light;
                            // Обновляем координаты, чтобы растение не вышло за границы
                            plant.x = Math.max(0, Math.min(areaWidth - plant.size, plant.x));
                            plant.y = Math.max(0, Math.min(areaHeight - plant.size, plant.y));
                        }
                        
                        if (plant.age % 30 === 0 && Math.random() < 0.3 && plants.value.length < 50) {
                            addPlant();
                            const newPlant = plants.value[plants.value.length - 1];
                            newPlant.x = Math.max(0, Math.min(areaWidth - newPlant.size, plant.x + (Math.random() * 40 - 20)));
                            newPlant.y = Math.max(0, Math.min(areaHeight - newPlant.size, plant.y + (Math.random() * 40 - 20)));
                            newPlant.size = 10;
                            newPlant.health = 1.0;
                        }
                    }
                
                    if (Math.random() < 0.1 && plants.value.length < 30) {
                        addPlant();
                    }
                };
                
                const startSimulation = () => {
                    if (!isSimulating.value) {
                        isSimulating.value = true;
                        simulationInterval = setInterval(simulateDay, 500);
                    }
                };
                
                const stopSimulation = () => {
                    isSimulating.value = false;
                    clearInterval(simulationInterval);
                };
                
                const reset = () => {
                    stopSimulation();
                    plants.value = [];
                    day.value = 0;
                };
                
                onMounted(() => {
                    for (let i = 0; i < 5; i++) {
                        addPlant();
                    }
                });
                
                return {
                    simulationArea,
                    plants,
                    day,
                    isSimulating,
                    addPlant,
                    getPlantTooltip,
                    simulateDay,
                    startSimulation,
                    stopSimulation,
                    reset
                };
            }
        }).mount('#app');
    </script>
</body>
</html>